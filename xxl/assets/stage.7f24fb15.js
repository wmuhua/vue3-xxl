var E=Object.defineProperty;var M=(m,i,n)=>i in m?E(m,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[i]=n;var y=(m,i,n)=>(M(m,typeof i!="symbol"?i+"":i,n),n);var z="./assets/text.48e931be.png";class _{constructor(i,n,t){y(this,"x");y(this,"y");y(this,"size");y(this,"typeCount",7);y(this,"matrix",[]);y(this,"data",[]);y(this,"isHandle",!1);y(this,"isSelect",!1);y(this,"score",0);y(this,"target1",{active:!1});y(this,"target2",{});this.x=i,this.y=n,this.size=t,this.getMatrix(),this.init(!0)}click(i){if(this.isHandle)return;const{isSelect:n}=this;if(!n)i.active=!0,this.target1=i,this.isSelect=!0;else{if(this.target1===i)return;this.target1.active=!1,["left","top","bottom","right"].some(t=>this.target1[t]==i)?(this.target2=i,(async()=>(await this.swap(),await this.gameLoop()||await this.swap()))(),this.isSelect=!1):(i.active=!0,this.target1=i,this.isSelect=!0)}}swap(){return new Promise((i,n)=>{const{target1:t,target2:o,data:r}=this,{positionLeft:p,positionTop:a,x:h,y:s,left:e,top:f,bottom:l,right:x}=t,{positionLeft:v,positionTop:S,x:g,y:u,left:w,top:b,bottom:T,right:L}=o;setTimeout(()=>{h==g&&(t.left=w,t.right=L,o.left=e,o.right=x,u>s?(t.top=l,t.bottom=T,o.top=f,o.bottom=b):(t.top=b,t.bottom=f,o.top=T,o.bottom=l)),s==u&&(t.top=b,t.bottom=T,o.top=f,o.bottom=l,g>h?(t.left=x,t.right=L,o.left=e,o.right=w):(t.left=w,t.right=e,o.left=L,o.right=x)),t.positionLeft=v,t.positionTop=S,t.x=g,t.y=u,o.positionLeft=p,o.positionTop=a,o.x=h,o.y=s,r.forEach(c=>{c.left=r.find(d=>d.x==c.x-1&&d.y==c.y),c.right=r.find(d=>d.x==c.x+1&&d.y==c.y),c.top=r.find(d=>d.x==c.x&&d.y==c.y-1),c.bottom=r.find(d=>d.x==c.x&&d.y==c.y+1)})},0),setTimeout(()=>{i(!0)},500)})}async gameLoop(i=!1){i&&(this.score=0),this.isHandle=!0,await this.remove();let n=this.data.some(t=>t.status==="remove");for(;this.data.some(t=>t.status==="remove");)await this.down(),await this.add(),await this.remove();return this.isHandle=!1,n}remove(){return new Promise((i,n)=>{const{data:t}=this;t.forEach(o=>{const{left:r,right:p,top:a,bottom:h,type:s}=o;(r==null?void 0:r.type)==s&&(p==null?void 0:p.type)==s&&(r.status="remove",o.status="remove",p.status="remove"),(a==null?void 0:a.type)==s&&(h==null?void 0:h.type)==s&&(a.status="remove",o.status="remove",h.status="remove")}),setTimeout(()=>{t.forEach((o,r)=>{o.status==="remove"&&(o.scale=0,this.score+=1)})},100),setTimeout(()=>{i(!0)},500)})}down(){return new Promise((i,n)=>{const{data:t,size:o,x:r,y:p}=this;t.forEach((a,h)=>{let s=0;if(a.status==="remove"){let e=a.top;for(;e;)e.status!=="remove"&&(s+=1),e=e.top;s&&(a.y-=s,a.positionTop=a.positionTop-o*s)}else{let e=a.bottom;for(;e;)e.status==="remove"&&(s+=1),e=e.bottom;s&&(a.y+=s,a.positionTop=a.positionTop+o*s)}}),setTimeout(()=>{i(!0)},500)})}add(){return new Promise((i,n)=>{const{size:t,matrix:o}=this;this.getMatrix(),this.matrix=o.map((r,p)=>r.map((a,h)=>this.data.find(s=>h==s.x&&p==s.y))),this.init(),setTimeout(()=>{this.data.forEach(r=>{r.status==="add"&&(r.scale=1,r.status="normal")})},100),setTimeout(()=>{i(!0)},500)})}getMatrix(){const{x:i,y:n}=this,t=new Array(i).fill(void 0),o=new Array(n).fill(void 0).map(r=>t);this.matrix=o}init(i=!1){const{x:n,y:t,typeCount:o,matrix:r,size:p}=this,a=[];let h=0,s=0;for(let e=0,f=Math.pow(n,2);e<f;e++){let l;try{l=r[s][h]}catch{}let x=l&&l.status!=="remove",v={type:x?l.type:Math.floor(Math.random()*o),x:h,y:s,status:i||x?"normal":"add",positionLeft:x?l.positionLeft:p*h,positionTop:x?l.positionTop:p*s,left:void 0,top:void 0,bottom:void 0,right:void 0,scale:i||x?1:0,key:l?l.key+e:`${h}${s}`,active:!1};a.push(v),h++,h==n&&(h=0,s++)}a.forEach(e=>{e.left=a.find(f=>f.x==e.x-1&&f.y==e.y),e.right=a.find(f=>f.x==e.x+1&&f.y==e.y),e.top=a.find(f=>f.x==e.x&&f.y==e.y-1),e.bottom=a.find(f=>f.x==e.x&&f.y==e.y+1)}),this.data=a}}export{_ as S,z as _};
